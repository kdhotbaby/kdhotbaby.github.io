<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="hotbaby's blog"><title>Djaong cache | hotbaby</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Djaong cache</h1><a id="logo" href="/.">hotbaby</a><p class="description">hotbaby's blog</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Djaong cache</h1><div class="post-meta">Apr 6, 2017<span> | </span><span class="category"><a href="/categories/django/">django</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/04/06/djaong-cache/" href="/2017/04/06/djaong-cache/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP缓存介绍"><span class="toc-number">1.</span> <span class="toc-text">HTTP缓存介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存框架"><span class="toc-number">2.</span> <span class="toc-text">缓存框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存实现"><span class="toc-number">2.1.</span> <span class="toc-text">缓存实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CacheHandler"><span class="toc-number">2.1.1.</span> <span class="toc-text">CacheHandler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#缓存backends"><span class="toc-number">2.1.2.</span> <span class="toc-text">缓存backends</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存中间件"><span class="toc-number">2.2.</span> <span class="toc-text">缓存中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FetchFromCacheMiddleware"><span class="toc-number">2.2.1.</span> <span class="toc-text">FetchFromCacheMiddleware</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UpdateCacheMiddleware"><span class="toc-number">2.2.2.</span> <span class="toc-text">UpdateCacheMiddleware</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存装饰器"><span class="toc-number">2.3.</span> <span class="toc-text">缓存装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nerver-cache"><span class="toc-number">2.3.1.</span> <span class="toc-text">nerver_cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cache-control"><span class="toc-number">2.3.2.</span> <span class="toc-text">cache_control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cache-page"><span class="toc-number">2.3.3.</span> <span class="toc-text">cache_page</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><p>每次用户请求一个页面，Web服务器都要进行很多计算，查询数据库，合成模板，处理业务逻辑等，再将页面返回给用户．后续的相同资源的请求，服务器都需要重复这些计算．</p>
<p>django提供了缓存机制，每次将资源的响应的副本存储指定的位置，下次用户再发起相同的请求时，服务器不再需要进行类似的计算，直接将上次响应的副本返回给用户．这样既减少服务器的负载，又降低用户的请求时延，提高了用户体验．</p>
<h2 id="HTTP缓存介绍"><a href="#HTTP缓存介绍" class="headerlink" title="HTTP缓存介绍"></a>HTTP缓存介绍</h2><p>TODO</p>
<h2 id="缓存框架"><a href="#缓存框架" class="headerlink" title="缓存框架"></a>缓存框架</h2><p>缓存是django的一个核心组件，提供缓存服务。</p>
<h3 id="缓存实现"><a href="#缓存实现" class="headerlink" title="缓存实现"></a>缓存实现</h3><p><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache.png?raw=true" alt=""></p>
<p><strong>config cache</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">settings.CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;  </div><div class="line">        <span class="string">'BACKEND'</span>:<span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</div><div class="line">    &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以memcached为例介绍缓存的配置，<code>BACKEND</code>是缓存实例实现类，<code>LOCATION</code>是缓存实例的位置．</p>
<h4 id="CacheHandler"><a href="#CacheHandler" class="headerlink" title="CacheHandler"></a>CacheHandler</h4><p><code>CacheHandler</code>管理缓存实例的访问。</p>
<p>实现原理： 根据<code>settings.CACHES</code>中配置（运行时）创建缓存实例，重载<code>__getitem__</code>特殊方法管理缓存实例的访问，通过线程局部变量<code>thread.local()</code>保证对于<code>settings.CACHES</code>中每个缓存在每个线程中只有一个实例．</p>
<p><code>django.core.cache.caches</code> 是<code>CacheHandler</code>的一个实例，<code>django.core.cache.cache</code> 是<code>caches[&#39;default&#39;]</code>的代理．</p>
<h4 id="缓存backends"><a href="#缓存backends" class="headerlink" title="缓存backends"></a>缓存backends</h4><p>采用模板方法的设计模式，通过抽象基类<code>BaseCache</code>声明了一套缓存操作接口，而将接口实现延迟到具体的子类中。如图所示：<br><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache-backends.png?raw=true" alt=""></p>
<p><code>BaseCache</code> 是一个抽象类，定义了缓存通用的操作接口和参数默认值．</p>
<p>其中重要的参数：</p>
<ul>
<li><code>key</code> 生成机制</li>
<li><code>timeout</code> 超时时间</li>
<li><code>max_entries</code> 最大条目数</li>
<li><code>cull_frequency</code> 更新频率</li>
</ul>
<p><code>MemcachedCache</code>实现抽象类中声明的接口，通过<code>_cache</code>实现数据的设置和获取操作．</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@property</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_cache</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Implements transparent thread-safe access to a memcached client.</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> getattr(self, <span class="string">'_client'</span>, <span class="keyword">None</span>) <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">        self._client = self._lib.Client(self._servers)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> self._client</div></pre></td></tr></table></figure>
<p><code>LocMemCache</code>实现了线程安全本地内存缓存．</p>
<p>实现原理：<code>_cache</code>一个字典对象用于缓存内存对象，<code>_expire_info</code>一个字典对象用于缓存内存对象的过期时间，<code>_lock</code>是django内部实现一个读写锁保证线程安全．在存储和获取内存对象时，通过<code>pickle</code>进行对象的序列化和反序列化．</p>
<p><code>FileBasedCache</code>实现了基于文件的缓存机制．</p>
<p>实现原理： 缓存对象，将过期时间和内存对象通过<code>pickle</code>序列化后写入本地文件系统．获取对象，检查是否需要删除就的对象，反序列化，检查是否过期，返回对象．</p>
<h3 id="缓存中间件"><a href="#缓存中间件" class="headerlink" title="缓存中间件"></a>缓存中间件</h3><p>如果使能缓存中间件，每个django的页面都会被缓存．</p>
<p>缓存中间件的工作原理（参考实现代码）：</p>
<ul>
<li>只有状态码为200的，方法为HEAD,GET请求的响应被缓存</li>
<li>检测缓存中是否已缓存该请求的响应对象</li>
<li>如果命中，返回原始响应对象的一个浅拷贝（shallow copy）</li>
<li>如果未命中，继续处理view函数</li>
<li>根据请求的header决定是否需要缓存</li>
<li>设置响应的ETag, Last-Modified, Expires, Cache-Control HTTP header.</li>
</ul>
<p>配置缓存中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">settings.MIDDLEWARE = [</div><div class="line">    <span class="string">'django.middleware.cache.UpdateCacheMiddleware'</span>,</div><div class="line">    ...</div><div class="line">    <span class="string">'django.middleware.cache.FetchFromCacheMiddleware'</span>,</div><div class="line">]</div></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>在response阶段，中间件的处理顺序是bottom-top, <code>UPdateCacheMiddleware</code>必须最后被执行，因此放在靠前的位置．在request阶段，中间件的处理顺序是top-bottom, <code>FetchFromCacheMiddleware</code>必须最后被执行，因此放在靠后的位置．<br><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-middleware-ordering.png?raw=true" alt=""></p>
<h4 id="FetchFromCacheMiddleware"><a href="#FetchFromCacheMiddleware" class="headerlink" title="FetchFromCacheMiddleware"></a><code>FetchFromCacheMiddleware</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="string">"""</span></div><div class="line">      Checks whether the page is already cached and returns the cached</div><div class="line">      version if available.</div><div class="line">      """</div><div class="line">        <span class="comment"># 只缓存HEAD, GET的请求</span></div><div class="line">        <span class="keyword">if</span> request.method <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'GET'</span>, <span class="string">'HEAD'</span>):</div><div class="line">          request._cache_update_cache = <span class="keyword">False</span></div><div class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># Don't bother checking the cache.</span></div><div class="line"></div><div class="line"><span class="comment"># 获取GET方法的cache_key,如果不存在，则设置_cache_update_cache标志位为True，需要更新缓存</span></div><div class="line">        <span class="comment"># try and get the cached GET response</span></div><div class="line">      cache_key = get_cache_key(request, self.key_prefix, <span class="string">'GET'</span>, cache=self.cache)</div><div class="line">      <span class="keyword">if</span> cache_key <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">          request._cache_update_cache = <span class="keyword">True</span></div><div class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># No cache information available, need to rebuild.</span></div><div class="line">      response = self.cache.get(cache_key)</div><div class="line">        <span class="comment"># 如果cache为命中，而且请求的方法为HEAD,则获取请求方法为HEAD的cache_key</span></div><div class="line">        <span class="comment"># if it wasn't found and we are looking for a HEAD, try looking just for that</span></div><div class="line">      <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> request.method == <span class="string">'HEAD'</span>:</div><div class="line">          cache_key = get_cache_key(request, self.key_prefix, <span class="string">'HEAD'</span>, cache=self.cache)</div><div class="line">          response = self.cache.get(cache_key)</div><div class="line"></div><div class="line"><span class="comment"># 缓存都未命中，设置_cache_update_cache标志位为True,调用view函数，并更新缓存</span></div><div class="line">        <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">          request._cache_update_cache = <span class="keyword">True</span></div><div class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># No cache information available, need to rebuild.</span></div><div class="line"></div><div class="line"><span class="comment"># 缓存命中，设置_cache_update_cahe标志为False, 不调用view函数，不更新缓存</span></div><div class="line">        <span class="comment"># hit, return cached response</span></div><div class="line">      request._cache_update_cache = <span class="keyword">False</span></div><div class="line">      <span class="keyword">return</span> response</div></pre></td></tr></table></figure>
<h4 id="UpdateCacheMiddleware"><a href="#UpdateCacheMiddleware" class="headerlink" title="UpdateCacheMiddleware"></a><code>UpdateCacheMiddleware</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_should_update_cache</span><span class="params">(self, request, response)</span>:</span></div><div class="line">      <span class="keyword">return</span> hasattr(request, <span class="string">'_cache_update_cache'</span>) <span class="keyword">and</span> request._cache_update_cache</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></div><div class="line">      <span class="string">"""Sets the cache, if needed."""</span></div><div class="line">        <span class="comment"># 不缓存，直接返回Response</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._should_update_cache(request, response):</div><div class="line">          <span class="comment"># We don't need to update the cache, just return.</span></div><div class="line">          <span class="keyword">return</span> response</div><div class="line"></div><div class="line"><span class="comment"># 如果是流数据或状态码不为200, 不缓存</span></div><div class="line">        <span class="keyword">if</span> response.streaming <span class="keyword">or</span> response.status_code != <span class="number">200</span>:</div><div class="line">          <span class="keyword">return</span> response</div><div class="line"></div><div class="line"><span class="comment"># 如果是私有数据，不缓存</span></div><div class="line">        <span class="comment"># Don't cache responses that set a user-specific (and maybe security</span></div><div class="line">      <span class="comment"># sensitive) cookie in response to a cookie-less request.</span></div><div class="line">      <span class="keyword">if</span> <span class="keyword">not</span> request.COOKIES <span class="keyword">and</span> response.cookies <span class="keyword">and</span> has_vary_header(response, <span class="string">'Cookie'</span>):</div><div class="line">          <span class="keyword">return</span> response</div><div class="line"></div><div class="line">      <span class="comment"># Try to get the timeout from the "max-age" section of the "Cache-</span></div><div class="line">      <span class="comment"># Control" header before reverting to using the default cache_timeout</span></div><div class="line">      <span class="comment"># length.</span></div><div class="line">      timeout = get_max_age(response)</div><div class="line">      <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">          timeout = self.cache_timeout</div><div class="line">      <span class="keyword">elif</span> timeout == <span class="number">0</span>:</div><div class="line">          <span class="comment"># max-age was set to 0, don't bother caching.</span></div><div class="line">          <span class="keyword">return</span> response</div><div class="line">      </div><div class="line">        <span class="comment"># 设置缓存的HTTP头部信息</span></div><div class="line">        patch_response_headers(response, timeout)</div><div class="line">        <span class="comment"># 缓存响应</span></div><div class="line">        <span class="keyword">if</span> timeout:</div><div class="line">          cache_key = learn_cache_key(request, response, timeout, self.key_prefix, cache=self.cache)</div><div class="line">          <span class="keyword">if</span> hasattr(response, <span class="string">'render'</span>) <span class="keyword">and</span> callable(response.render):</div><div class="line">              response.add_post_render_callback(</div><div class="line">                  <span class="keyword">lambda</span> r: self.cache.set(cache_key, r, timeout)</div><div class="line">              )</div><div class="line">          <span class="keyword">else</span>:</div><div class="line">              self.cache.set(cache_key, response, timeout)</div><div class="line">      <span class="keyword">return</span> response</div></pre></td></tr></table></figure>
<h3 id="缓存装饰器"><a href="#缓存装饰器" class="headerlink" title="缓存装饰器"></a>缓存装饰器</h3><p>缓存装饰器用于控制view是否缓存.</p>
<h4 id="nerver-cache"><a href="#nerver-cache" class="headerlink" title="nerver_cache"></a>nerver_cache</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">never_cache</span><span class="params">(view_func)</span>:</span></div><div class="line"><span class="meta">    @wraps(view_func, assigned=available_attrs(view_func))</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_wrapped_view_func</span><span class="params">(request, *args, **kwargs)</span>:</span></div><div class="line">        response = view_func(request, *args, **kwargs)</div><div class="line">        add_never_cache_headers(response)</div><div class="line">        <span class="keyword">return</span> response</div><div class="line">    <span class="keyword">return</span> _wrapped_view_func</div></pre></td></tr></table></figure>
<p>view装饰器，在view函数处理完成后，patch缓存相关的HTTP头，控制该相应不被缓存。</p>
<p>相关的HTTP headers:</p>
<ul>
<li>Last-Modifed: current_datetime</li>
<li>Expires: current_datetime</li>
<li>Cache-Control: max-age=0</li>
</ul>
<h4 id="cache-control"><a href="#cache-control" class="headerlink" title="cache_control"></a>cache_control</h4><p>view装饰器，在view函数处理完成后，patch<code>Cache-Control</code>HTTP头。</p>
<h4 id="cache-page"><a href="#cache-page" class="headerlink" title="cache_page"></a>cache_page</h4><p>view装饰器，用于缓存页面。该装饰器是对cache中间件<code>CacheMiddleware</code>的封装。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.djangoproject.com/en/1.11/topics/cache/#the-low-level-cache-api" target="_blank" rel="external">django’s cache framework</a></li>
<li><a href="http://django-redis-chs.readthedocs.io/zh_CN/latest/" target="_blank" rel="external">django redis</a></li>
<li><a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="external">rfc7234  Hypertext Transfer Protocol (HTTP/1.1): Caching</a></li>
<li><a href="HTTP Cache-Control Extensions for Stale Content">rfc5861 HTTP Cache-Control Extensions for Stale Content</a></li>
<li><a href="https://github.com/django/django/tree/master/django/core/cache" target="_blank" rel="external">django core cache code</a></li>
<li><a href="https://docs.python.org/2/library/pickle.html" target="_blank" rel="external">python pickle library</a></li>
<li><a href="https://docs.python.org/2/library/threading.html#threading.local" target="_blank" rel="external">python threading.local</a></li>
<li><a href="https://docs.djangoproject.com/en/1.10/ref/middleware/#middleware-ordering" target="_blank" rel="external">django middleware ordering</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.hotbaby.org/2017/04/06/djaong-cache/" data-id="cj58ue39500335sfsmmj5nbdj" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/django/">django</a><a href="/tags/cache/">cache</a></div><div class="post-nav"><a href="/2017/04/19/git/" class="pre">Git</a><a href="/2017/04/01/RSS-feed/" class="next">RSS feed</a></div><div id="disqus_thread"><script>var disqus_shortname = 'hotbaby-1';
var disqus_identifier = '2017/04/06/djaong-cache/';
var disqus_title = 'Djaong cache';
var disqus_url = 'http://blog.hotbaby.org/2017/04/06/djaong-cache/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//hotbaby-1.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://blog.hotbaby.org"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/django/">django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/旅行/">旅行</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Cobra/" style="font-size: 15px;">Cobra</a> <a href="/tags/django/" style="font-size: 15px;">django</a> <a href="/tags/Lisp/" style="font-size: 15px;">Lisp</a> <a href="/tags/Paul-Graham/" style="font-size: 15px;">Paul Graham</a> <a href="/tags/电影/" style="font-size: 15px;">电影</a> <a href="/tags/跑步/" style="font-size: 15px;">跑步</a> <a href="/tags/PEP/" style="font-size: 15px;">PEP</a> <a href="/tags/PyPI/" style="font-size: 15px;">PyPI</a> <a href="/tags/decorator/" style="font-size: 15px;">decorator</a> <a href="/tags/closure/" style="font-size: 15px;">closure</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/RSS/" style="font-size: 15px;">RSS</a> <a href="/tags/selenium/" style="font-size: 15px;">selenium</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/shadowsocks/" style="font-size: 15px;">shadowsocks</a> <a href="/tags/互联网/" style="font-size: 15px;">互联网</a> <a href="/tags/八达岭长城/" style="font-size: 15px;">八达岭长城</a> <a href="/tags/腾讯/" style="font-size: 15px;">腾讯</a> <a href="/tags/读书/" style="font-size: 15px;">读书</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/16/Python-metaclass/">Python metaclass</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/10/Python-descriptor/">Python  descriptor</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/09/Selenium/">Selenium</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/09/Python-context/">Python context</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/Python-debug/">Python debug</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/debian-timezone/">debian timezone</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/Python-customization/">Python customization</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/08/Python-pip-mirror/">Python pip mirror</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/Lisp/">Lisp</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/17/django-db-router/">Django database router</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://paulgraham.com/" title="Paul Graham" target="_blank">Paul Graham</a><ul></ul><a href="http://babywolfh.win" title="babywolfh's blog" target="_blank">babywolfh's blog</a><ul></ul><a href="https://www.haomwei.com/" title="9441's blog" target="_blank">9441's blog</a><ul></ul><a href="https://www.biaodianfu.com/" title="baiodianfu" target="_blank">baiodianfu</a><ul></ul><a href="https://docs.python.org/2/" title="Python 2.7.12 Documentation" target="_blank">Python 2.7.12 Documentation</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© 2017 <a href="/." rel="nofollow">hotbaby</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?bf8f991bdc9a9dc0e9009de94acefaf6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>